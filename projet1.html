<!-- Visualiseur PDF -->
<div class="pdf-viewer">
  <canvas id="pdf-canvas"></canvas>
  <div class="pdf-controls">
    <button id="prev-page">← Page précédente</button>
    <span>Page <span id="page-num">1</span> / <span id="page-count">?</span></span>
    <button id="next-page">Page suivante →</button>
    <a id="download-pdf" href="/images/projet1/powerbiimmo.pdf" download>
      <button>Télécharger PDF</button>
    </a>
  </div>
  <div id="pdf-caption" class="pdf-caption">
    <p>Description de la première page.</p>
  </div>
</div>

<style>
.pdf-viewer {
  text-align: center;
  max-width: 900px;
  margin: 2rem auto;
}

#pdf-canvas {
  width: 100%;
  border-radius: 1rem;
  box-shadow: 0 6px 12px rgba(0,0,0,0.3);
}

.pdf-controls {
  margin-top: 1rem;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.pdf-controls button {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 0.5rem;
  background-color: rgba(0,0,0,0.4);
  color: #fff;
  cursor: pointer;
  font-size: 1rem;
}

.pdf-controls button:hover {
  background-color: rgba(0,0,0,0.7);
}

.pdf-caption {
  margin-top: 1rem;
  background: rgba(0,0,0,0.6);
  padding: 1rem;
  border-radius: 1rem;
  color: #fff;
  font-size: 1rem;
  text-align: left;
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.12.313/pdf.min.js"></script>
<script>
const url = '/images/projet1/powerbiimmo.pdf'; // chemin vers ton PDF
const captions = [
  "Page 1 : Tableau de bord principal du projet.",
  "Page 2 : Comparaison des villes et évolution des prix.",
  "Page 3 : Simulation des emprunts et rentabilité locative.",
  "Page 4 : Analyse régionale et tendances du marché."
];

let pdfDoc = null,
    pageNum = 1,
    pageIsRendering = false,
    pageNumIsPending = null;

const scale = 1.2;
const canvas = document.getElementById('pdf-canvas');
const ctx = canvas.getContext('2d');
const captionDiv = document.getElementById('pdf-caption');

function renderPage(num) {
  pageIsRendering = true;

  pdfDoc.getPage(num).then(page => {
    const viewport = page.getViewport({ scale });
    canvas.height = viewport.height;
    canvas.width = viewport.width;

    const renderCtx = {
      canvasContext: ctx,
      viewport: viewport
    };

    page.render(renderCtx).promise.then(() => {
      pageIsRendering = false;
      if (pageNumIsPending !== null) {
        renderPage(pageNumIsPending);
        pageNumIsPending = null;
      }
    });

    document.getElementById('page-num').textContent = num;
    captionDiv.innerHTML = `<p>${captions[num - 1] || ""}</p>`;
  });
}

function queueRenderPage(num) {
  if (pageIsRendering) {
    pageNumIsPending = num;
  } else {
    renderPage(num);
  }
}

function showPrevPage() {
  if (pageNum <= 1) return;
  pageNum--;
  queueRenderPage(pageNum);
}

function showNextPage() {
  if (pageNum >= pdfDoc.numPages) return;
  pageNum++;
  queueRenderPage(pageNum);
}

document.getElementById('prev-page').addEventListener('click', showPrevPage);
document.getElementById('next-page').addEventListener('click', showNextPage);

// Chargement du PDF
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.12.313/pdf.worker.min.js';

pdfjsLib.getDocument(url).promise.then(pdfDoc_ => {
  pdfDoc = pdfDoc_;
  document.getElementById('page-count').textContent = pdfDoc.numPages;
  renderPage(pageNum);
});
</script>
