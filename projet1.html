<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Projet - Lydérick Henry</title>
  <style>
    body { margin:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg,#1c1c1c,#2c2c54); color:#f4f4f4; display:flex; flex-direction:column; min-height:100vh; }
    header { text-align:center; padding:2rem 1rem; }
    header h1 { font-size:2rem; margin-bottom:0.5rem; }
    header a { color:#f4f4f4; text-decoration:none; font-size:0.9rem; border-bottom:1px solid #f4f4f4; }
    main { flex:1; max-width:900px; margin:0 auto; padding:2rem; }
    main h2 { font-size:1.5rem; margin-bottom:1rem; }
    main p, main ul { margin-bottom:1.5rem; line-height:1.6; }
    .slider-container { position:relative; max-width:900px; margin:2rem auto; overflow:hidden; border-radius:1rem; box-shadow:0 6px 12px rgba(0,0,0,0.3); background:#000; text-align:center; min-height:400px; }
    #pdf-render { width:100%; display:block; margin:auto; border-radius:1rem 1rem 0 0; max-width:100%; }
    .caption { background:rgba(0,0,0,0.8); padding:1rem; border-radius:0 0 1rem 1rem; color:#fff; }
    .slider-container button { cursor:pointer; position:absolute; top:50%; width:auto; padding:0.5rem 1rem; margin-top:-1.5rem; color:#fff; font-weight:bold; font-size:2rem; border-radius:0.5rem; background-color:rgba(0,0,0,0.6); border:none; user-select:none; transition: background 0.3s; z-index:10; }
    .slider-container button:hover:not(:disabled) { background-color: rgba(0,0,0,0.9); }
    .slider-container button:disabled { opacity:0.3; cursor:not-allowed; }
    .prev { left:0.5rem; }
    .next { right:0.5rem; }
    .download-btn { display:inline-block; margin:1rem 0; padding:0.5rem 1rem; background:#2c2c54; color:#f4f4f4; text-decoration:none; border-radius:0.5rem; font-weight:bold; }
    .download-btn:hover { background:#1c1c1c; }
    .loading { text-align:center; padding:2rem; color:#ccc; }
    footer { text-align:center; padding:1rem; font-size:0.9rem; background:rgba(0,0,0,0.2); }
    footer a { color:#fff; text-decoration:none; }
  </style>
</head>
<body>
  <header>
    <h1>Projet PowerBI - Analyse immobilière</h1>
    <a href="index.html">← Retour à l'accueil</a>
  </header>

  <main>
    <h2>Explications</h2>
    <p>Projet Power BI : Simulateur interactif du marché immobilier...</p>

    <!-- Slider PDF -->
    <div class="slider-container">
      <canvas id="pdf-render"></canvas>
      <div class="caption" id="caption-text">
        <div class="loading">Chargement du PDF...</div>
      </div>
      <button class="prev" id="prev-btn">&#10094;</button>
      <button class="next" id="next-btn">&#10095;</button>
    </div>
    <a class="download-btn" href="images/projet1/PowerBiImmo.pdf" download>Télécharger PDF</a>

    <p>Version web disponible en dessous pour les détenteurs d'un compte avec licence</p>
    <iframe title="powerbiimmo -V3 avec liens" width="1140" height="541.25" src="https://app.powerbi.com/reportEmbed?reportId=595f7e1c-ae4d-4038-ad85-9f49f0734bc8&autoAuth=true&ctid=5dd8a2bb-ec68-4001-8b40-8d12dc51acd8" frameborder="0" allowFullScreen="true"></iframe>
  </main>

  <footer>
    <p>© 2025 - Portfolio de Lydérick Henry</p>
  </footer>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.358/pdf.min.js"></script>
  <script>
    // Configuration PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.358/pdf.worker.min.js';
    
    // Variables globales
    let pdfDoc = null;
    let pageNum = 1;
    let isLoading = false;

    // Éléments du DOM
    const canvas = document.getElementById('pdf-render');
    const ctx = canvas.getContext('2d');
    const caption = document.getElementById('caption-text');
    const btnPrev = document.getElementById('prev-btn');
    const btnNext = document.getElementById('next-btn');

    // URL du PDF - Testez d'abord avec un PDF de test
    const url = 'images/projet1/PowerBiImmo.pdf';

    console.log('Tentative de chargement du PDF depuis:', url);

    function updateButtons() {
      if (!pdfDoc) {
        btnPrev.disabled = true;
        btnNext.disabled = true;
        return;
      }
      btnPrev.disabled = (pageNum <= 1);
      btnNext.disabled = (pageNum >= pdfDoc.numPages);
    }

    function renderPage(num) {
      if (!pdfDoc || isLoading) {
        console.log('Rendu annulé - PDF non chargé ou déjà en cours');
        return;
      }
      
      isLoading = true;
      console.log('Rendu de la page:', num);
      
      pdfDoc.getPage(num).then(function(page) {
        const viewport = page.getViewport({ scale: 1.2 });
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        const renderContext = {
          canvasContext: ctx,
          viewport: viewport
        };

        return page.render(renderContext).promise;
      }).then(function() {
        isLoading = false;
        console.log('Page rendue avec succès');
        caption.innerHTML = `Page ${num} sur ${pdfDoc.numPages}`;
        updateButtons();
      }).catch(function(error) {
        isLoading = false;
        console.error('Erreur lors du rendu:', error);
        caption.innerHTML = 'Erreur lors du rendu de la page';
        updateButtons();
      });
    }

    function goToPage(targetPage) {
      if (!pdfDoc || isLoading) return;
      if (targetPage < 1 || targetPage > pdfDoc.numPages) return;
      
      pageNum = targetPage;
      renderPage(pageNum);
    }

    // Event listeners
    btnPrev.addEventListener('click', function() {
      goToPage(pageNum - 1);
    });

    btnNext.addEventListener('click', function() {
      goToPage(pageNum + 1);
    });

    // Initialisation
    updateButtons();
    caption.innerHTML = 'Tentative de chargement du PDF...';

    // Test de l'existence du fichier d'abord
    fetch(url, { method: 'HEAD' })
      .then(response => {
        if (!response.ok) {
          throw new Error(`Fichier non trouvé (${response.status})`);
        }
        console.log('Fichier PDF trouvé, chargement...');
        return pdfjsLib.getDocument(url).promise;
      })
      .then(function(pdf) {
        pdfDoc = pdf;
        console.log('PDF chargé avec succès -', pdf.numPages, 'pages');
        caption.innerHTML = `PDF chargé - ${pdf.numPages} pages`;
        
        // Attendre un petit délai avant le premier rendu
        setTimeout(() => {
          renderPage(1);
        }, 100);
      })
      .catch(function(error) {
        console.error('Erreur complète:', error);
        let errorMsg = '⚠️ Impossible de charger le PDF';
        
        if (error.message.includes('404') || error.message.includes('non trouvé')) {
          errorMsg += '<br><small>Le fichier n\'existe pas à l\'emplacement spécifié</small>';
        } else if (error.message.includes('CORS')) {
          errorMsg += '<br><small>Problème de sécurité CORS - servez le fichier depuis un serveur web</small>';
        } else {
          errorMsg += '<br><small>' + error.message + '</small>';
        }
        
        caption.innerHTML = `<div style="color: #ff6b6b;">${errorMsg}</div>`;
        updateButtons();
      });
  </script>
</body>
</html>
